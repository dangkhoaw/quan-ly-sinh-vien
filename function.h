#ifndef _FUNCTION_H_
#define _FUNCTION_H_

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <windows.h>
#include <conio.h>
#include <stdbool.h>

/*
                         _oo0oo_
                        o8888888o
                        88" . "88
                        (| -_- |)
                        0\  =  /0
                      ___/`---'\___
                    .' \\|     |// '.
                  // \\|||  :  |||// \\
                 // _||||| -:- |||||- \\
                 |   | \\\  -  /// |   |
                 | \_|  ''\---/''  |_/ |
                 \  .-\__  '-'  ___/-. /
               ___'. .'  /--.--\  `. .'___
            ."" '<  `.___\_<|>_/___.' >' "".
           | | :  `- \`.;`\ _ /`;.`/ - ` : | |
           \  \ `_.   \_ __\ /__ _/   .-` /  /
       =====`-.____`.___ \_____/___.-`___.-'=====
                         `=---='

       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
              Ph·∫≠t ph√π h·ªô, kh√¥ng bao gi·ªù BUG
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/
#define MAX_USERNAME_LENGTH 30
#define MIN_USERNAME_LENGTH 5
#define MAX_PASSWORD_LENGTH 30
#define MIN_PASSWORD_LENGTH 8
#define MAX_SIZE 100
#define MAX_CLASS 11
#define and &&
#define or ||

char facultyCode[4];
char academicYear[3];
char classList[10][15];

struct Student
{
    char ID[10];
    char fullName[35];
    char firstName[10]; // T√™n
    char lastName[25];  // H·ªç
    char email[25];
    char birthDay[15];
    char gender[5];
    char address[30];
};
typedef struct Student *STUDENT;

struct StudentList
{
    int count;
    bool isSorted;
    bool hasID;
    STUDENT *std;
};
typedef struct StudentList *STUDENTLIST;

//------------------------------------------------------------------------------------------------------------------------

void removeEnter(char string[]) // Do h√†m fgets l·∫•y d·∫•u enter n√™n ph·∫£i x√≥a d·∫•u enter ra
{
    size_t len = strlen(string);
    if (string[len - 1] == '\n')
    {
        string[len - 1] = '\0';
    }
}

bool isNumber(char c) // Ki·ªÉm tra k√≠ t·ª± s·ªë
{
    return c >= '0' and c <= '9';
}

bool isLower(char c) // Ki·ªÉm tra k√≠ t·ª± th∆∞·ªùng
{
    return c >= 'a' and c <= 'z';
}

bool isUpper(char c) // Ki·ªÉm tra k√≠ t·ª± hoa
{
    return c >= 'A' and c <= 'Z';
}

char *toLower(char string[]) // Chuy·ªÉn th√†nh chu·ªói in th∆∞·ªùng
{
    for (int i = 0; i < strlen(string); i++)
        if (string[i] >= 65 and string[i] <= 90)
            string[i] += 32;
    return string;
}

char *toUpper(char string[]) // Chuy·ªÉn th√†nh chu·ªói in hoa
{
    for (int i = 0; i < strlen(string); i++)
        if (string[i] >= 97 and string[i] <= 122)
            string[i] -= 32;
    return string;
}

char *lTrim(char string[]) // C·∫Øt kho·∫£ng tr·ªëng b√™n tr√°i
{
    int i = 0;
    while (string[i] == ' ')
    {
        i++;
    }
    if (i > 0)
    {
        strcpy(&string[0], &string[i]);
    }
    return string;
}

char *rTrim(char string[]) // C·∫Øt kho·∫£ng tr·ªëng b√™n ph·∫£i
{
    int i = strlen(string) - 1;
    while (string[i] == ' ')
    {
        i--;
    }
    string[i + 1] = '\0';
    return string;
}

char *trim(char string[]) // C·∫Øt kho·∫£ng tr·ªëng d∆∞ th·ª´a ·ªü gi·ªØa v√† hai ƒë·∫ßu
{
    rTrim(lTrim(string));
    char *doubleSpace = strstr(string, "  ");
    while (doubleSpace != NULL)
    {
        strcpy(doubleSpace, doubleSpace + 1); // X√≥a 1 d·∫•u c√°ch
        doubleSpace = strstr(string, "  ");
    }
    return string;
}

char *toName(char string[]) // Chuy·ªÉn chu·ªói th√†nh t√™n
{
    trim(string);
    toLower(string);
    for (int i = 0; i < strlen(string); i++)
        if (i == 0 or (i > 0 and string[i - 1] == ' '))
            string[i] = string[i] - 32;
    return string;
}

//------------------------------------------------------------------------------------------------------------------------

STUDENTLIST createClass() // T·∫°o danh s√°ch sinh vi√™n
{
    STUDENTLIST Class = malloc(sizeof(struct StudentList));
    Class->count = 0;
    Class->std = malloc(MAX_SIZE * sizeof(struct Student));
    return Class;
}

bool checkFacultyCode() // Ki·ªÉm tra m√£ khoa
{
    if (strcmp(facultyCode, "101") == 0 or strcmp(facultyCode, "102") == 0 or strcmp(facultyCode, "103") == 0 or
        strcmp(facultyCode, "104") == 0 or strcmp(facultyCode, "105") == 0 or strcmp(facultyCode, "106") == 0 or
        strcmp(facultyCode, "107") == 0 or strcmp(facultyCode, "109") == 0 or strcmp(facultyCode, "110") == 0 or
        strcmp(facultyCode, "111") == 0 or strcmp(facultyCode, "117") == 0 or strcmp(facultyCode, "118") == 0 or
        strcmp(facultyCode, "121") == 0 or strcmp(facultyCode, "123") == 0)
    {
        return true;
    }
    printf("\n‚ö†Ô∏è M√£ khoa kh√¥ng h·ª£p l·ªá, m·ªùi nh·∫≠p l·∫°i\n");
    return false;
}

void printListClassName() // In t√™n c√°c l·ªõp
{
    int numClass = 0;
    char classList[10][15];
    if (strcmp(facultyCode, "101") == 0)
    {
        sprintf(classList[0], "%sC1A", academicYear);
        sprintf(classList[1], "%sC1B", academicYear);
        sprintf(classList[2], "%sC1C", academicYear);
        sprintf(classList[3], "%sC1D", academicYear);
        sprintf(classList[4], "%sCDT1", academicYear);
        sprintf(classList[5], "%sCDT2", academicYear);
        sprintf(classList[6], "%sCDT3", academicYear);
        sprintf(classList[7], "%sCDT4", academicYear);
        sprintf(classList[8], "%sCKHK", academicYear);

        numClass = 9;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "102") == 0)
    {
        sprintf(classList[0], "%sT_DT1", academicYear);
        sprintf(classList[1], "%sT_DT2", academicYear);
        sprintf(classList[2], "%sT_DT3", academicYear);
        sprintf(classList[3], "%sT_DT4", academicYear);
        sprintf(classList[4], "%sT_KHDL1", academicYear);
        sprintf(classList[5], "%sT_KHDL2", academicYear);
        sprintf(classList[6], "%sT_Nhat1", academicYear);
        sprintf(classList[7], "%sT_Nhat2", academicYear);

        numClass = 8;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "103") == 0)
    {
        sprintf(classList[0], "%sC4A", academicYear);
        sprintf(classList[1], "%sC4B", academicYear);
        sprintf(classList[2], "%sC4C", academicYear);
        sprintf(classList[3], "%sHTCN", academicYear);
        sprintf(classList[4], "%sKTOTO1", academicYear);
        sprintf(classList[5], "%sKTOTO2", academicYear);
        sprintf(classList[6], "%sKTTT", academicYear);

        numClass = 7;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "104") == 0)
    {
        sprintf(classList[0], "%sN1", academicYear);
        sprintf(classList[1], "%sN2", academicYear);

        numClass = 2;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "105") == 0)
    {
        sprintf(classList[0], "%sD1", academicYear);
        sprintf(classList[1], "%sD2", academicYear);
        sprintf(classList[2], "%sD3", academicYear);
        sprintf(classList[3], "%sD4", academicYear);
        sprintf(classList[4], "%sD5", academicYear);
        sprintf(classList[5], "%sTDH1", academicYear);
        sprintf(classList[6], "%sTDH2", academicYear);
        sprintf(classList[7], "%sTDH3", academicYear);

        numClass = 8;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "106") == 0)
    {
        sprintf(classList[0], "%sDT1", academicYear);
        sprintf(classList[1], "%sDT2", academicYear);
        sprintf(classList[2], "%sDT3", academicYear);
        sprintf(classList[3], "%sDT4", academicYear);
        sprintf(classList[4], "%sKTMT1", academicYear);
        sprintf(classList[5], "%sKTMT2", academicYear);

        numClass = 6;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "107") == 0)
    {
        sprintf(classList[0], "%sH2A", academicYear);
        sprintf(classList[1], "%sH2B", academicYear);
        sprintf(classList[2], "%sH2C", academicYear);
        sprintf(classList[3], "%sH5", academicYear);
        sprintf(classList[4], "%sKTHH1", academicYear);
        sprintf(classList[5], "%sKTHH2", academicYear);
        sprintf(classList[6], "%sSH1", academicYear);
        sprintf(classList[7], "%sSH2", academicYear);
        sprintf(classList[8], "%sSHYD", academicYear);

        numClass = 9;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "109") == 0)
    {
        sprintf(classList[0], "%sBIM_AI", academicYear);
        sprintf(classList[1], "%sCSHT", academicYear);
        sprintf(classList[2], "%sVLXD", academicYear);
        sprintf(classList[3], "%sX3", academicYear);

        numClass = 4;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "110") == 0)
    {
        sprintf(classList[0], "%sX1A", academicYear);
        sprintf(classList[1], "%sX1B", academicYear);
        sprintf(classList[2], "%sX1C", academicYear);
        sprintf(classList[3], "%sX1D", academicYear);

        numClass = 4;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "111") == 0)
    {
        sprintf(classList[0], "%sDTTM", academicYear);
        sprintf(classList[1], "%sTHXD", academicYear);
        sprintf(classList[2], "%sX2", academicYear);

        numClass = 3;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "117") == 0)
    {
        sprintf(classList[0], "%sMT", academicYear);
        sprintf(classList[1], "%sQLMT", academicYear);

        numClass = 2;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "118") == 0)
    {
        sprintf(classList[0], "%sKX1", academicYear);
        sprintf(classList[1], "%sKX2", academicYear);
        sprintf(classList[2], "%sKX3", academicYear);
        sprintf(classList[3], "%sQLCN1", academicYear);
        sprintf(classList[4], "%sQLCN2", academicYear);
        sprintf(classList[5], "%sQLCN3", academicYear);

        numClass = 6;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "121") == 0)
    {
        sprintf(classList[0], "%sKT1", academicYear);
        sprintf(classList[1], "%sKT2", academicYear);

        numClass = 2;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
    else if (strcmp(facultyCode, "123") == 0)
    {
        sprintf(classList[0], "%sPFIEV1", academicYear);
        sprintf(classList[1], "%sPFIEV2", academicYear);
        sprintf(classList[2], "%sPFIEV3", academicYear);
        sprintf(classList[3], "%sES", academicYear);
        sprintf(classList[4], "%sECE", academicYear);

        numClass = 5;
        printf("\n");
        for (int i = 0; i < numClass; i++)
        {
            printf("üìö %s\n", classList[i]);
        }
    }
}

void printFacultyName() // In t√™n khoa
{
    printf("\nüìö 101: Khoa C∆° kh√≠\n");
    printf("üìö 102: Khoa C√¥ng ngh·ªá Th√¥ng tin\n");
    printf("üìö 103: Khoa C∆° kh√≠ Giao th√¥ng\n");
    printf("üìö 104: Khoa CN Nhi·ªát-ƒêi·ªán l·∫°nh\n");
    printf("üìö 105: Khoa ƒêi·ªán\n");
    printf("üìö 106: Khoa ƒêi·ªán t·ª≠ Vi·ªÖn Th√¥ng\n");
    printf("üìö 107: Khoa H√≥a\n");
    printf("üìö 109: Khoa X√¢y d·ª±ng C·∫ßu-ƒê∆∞·ªùng\n");
    printf("üìö 110: Khoa X√¢y d·ª±ng D√¢n d·ª•ng - C√¥ng nghi·ªáp\n");
    printf("üìö 111: Khoa X√¢y d·ª±ng c√¥ng tr√¨nh th·ªßy\n");
    printf("üìö 117: Khoa M√¥i tr∆∞·ªùng\n");
    printf("üìö 118: Khoa Qu·∫£n l√≠ d·ª± √°n\n");
    printf("üìö 121: Khoa Ki·∫øn tr√∫c\n");
    printf("üìö 123: Khoa Khoa h·ªçc C√¥ng ngh·ªá ti√™n ti·∫øn\n");
}

void inputCode() // Nh·∫≠p m√£ kh√≥a v√† m√£ khoa
{
    printf("\n‚û°Ô∏è  M·ªùi b·∫°n nh·∫≠p v√†o m√£ kh√≥a: ");
    scanf("%s", academicYear);

    printFacultyName();
    do
    {
        printf("\n‚û°Ô∏è  M·ªùi b·∫°n nh·∫≠p v√†o m√£ khoa: ");
        scanf("%s", facultyCode);
    } while (checkFacultyCode() == 0);
}

bool checkClassName(char className[]) // Ki·ªÉm tra t√™n l·ªõp
{
    if (strcmp(facultyCode, "101") == 0) // Khoa C∆° kh√≠
    {
        if (strstr(className, "C1") or strstr(className, "CDT") or strstr(className, "CKHK"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "102") == 0) // Khoa C√¥ng ngh·ªá Th√¥ng tin
    {
        if (strstr(className, "T_DT") or strstr(className, "T_KHDL") or strstr(className, "T_Nhat"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "103") == 0) // Khoa C∆° kh√≠ Giao th√¥ng
    {
        if (strstr(className, "C4") or strstr(className, "HTCN") or strstr(className, "KTOTO") or strstr(className, "KTTT"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "104") == 0) // Khoa CN Nhi·ªát-ƒêi·ªán l·∫°nh
    {
        if (strstr(className, "N"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "105") == 0) // Khoa ƒêi·ªán
    {
        if (strstr(className, "D") or strstr(className, "TDH"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "106") == 0) // Khoa ƒêi·ªán t·ª≠ Vi·ªÖn Th√¥ng
    {
        if (strstr(className, "DT") or strstr(className, "KTMT"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "107") == 0) // Khoa H√≥a
    {
        if (strstr(className, "H2") or strstr(className, "H5") or strstr(className, "KTHH") or strstr(className, "SH") or strstr(className, "SHYD"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "109") == 0) // Khoa X√¢y d·ª±ng C·∫ßu-ƒê∆∞·ªùng
    {
        if (strstr(className, "BIM_AI") or strstr(className, "CSHT") or strstr(className, "VLXD") or strstr(className, "X3"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "110") == 0) // Khoa X√¢y d·ª±ng D√¢n d·ª•ng - C√¥ng nghi·ªáp
    {
        if (strstr(className, "X1"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "111") == 0) // Khoa X√¢y d·ª±ng c√¥ng tr√¨nh th·ªßy
    {
        if (strstr(className, "DTTM") or strstr(className, "THXD") or strstr(className, "X2"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "117") == 0) // Khoa M√¥i tr∆∞·ªùng
    {
        if (strstr(className, "MT") or strstr(className, "QLMT"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "118") == 0) // Khoa Qu·∫£n l√≠ d·ª± √°n
    {
        if (strstr(className, "KX") or strstr(className, "QLCN"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "121") == 0) // Khoa Ki·∫øn tr√∫c
    {
        if (strstr(className, "KT"))
        {
            return true;
        }
    }
    else if (strcmp(facultyCode, "123") == 0) // Khoa Khoa h·ªçc CNghe ti√™n ti·∫øn
    {
        if (strstr(className, "PFIEV") or strstr(className, "ES") or strstr(className, "ECE"))
        {
            return true;
        }
    }
    printf("\n‚ö†Ô∏è  T√™n l·ªõp kh√¥ng h·ª£p l·ªá, c·∫ßn nh·∫≠p l·∫°i\n");
    return false;
}

void insertStudent(STUDENTLIST Class, STUDENT std) // Th√™m sinh vi√™n v√†o danh s√°ch
{
    if (Class->count >= MAX_SIZE)
    {
        printf("\nüîî L·ªõp n√†y ƒë√£ ƒë·ªß sinh vi√™n\n");
        return;
    }
    Class->std[Class->count++] = std;
}

void printClassToFile(STUDENTLIST class, FILE *f) // In danh s√°ch sinh vi√™n ra file
{
    if (strcmp(class->std[0]->ID, "") == 0)
    {
        fprintf(f, "%-11s %-25s %-17s %-16s %s\n", "STT", "H·ªç v√† t√™n", "Gi·ªõi t√≠nh", "Ng√†y sinh", "ƒê·ªãa ch·ªâ");
        for (int i = 0; i < class->count; i++)
        {
            fprintf(f, " %-5d %-29s %-11s %-15s %s\n", i + 1, class->std[i]->fullName, class->std[i]->gender, class->std[i]->birthDay, class->std[i]->address);
        }
    }
    else if (strcmp(class->std[0]->email, "") == 0)
    {
        fprintf(f, "%-5s %-23s %-24s %-17s %-16s %s\n", "STT", "M√£ sinh vi√™n", "H·ªç v√† t√™n", "Gi·ªõi t√≠nh", "Ng√†y sinh", "ƒê·ªãa ch·ªâ");
        for (int i = 0; i < class->count; i++)
        {
            fprintf(f, " %-5d %-15s %-28s %-11s %-15s %s\n", i + 1, class->std[i]->ID, class->std[i]->fullName, class->std[i]->gender, class->std[i]->birthDay, class->std[i]->address);
        }
    }
    else
    {
        fprintf(f, "%-5s %-23s %-33s %-21s %-17s %-16s %s\n", "STT", "M√£ sinh vi√™n", "H·ªç v√† t√™n", "Email", "Gi·ªõi t√≠nh", "Ng√†y sinh", "ƒê·ªãa ch·ªâ");
        for (int i = 0; i < class->count; i++)
        {
            fprintf(f, " %-5d %-15s %-26s %-31s %-12s %-15s %s\n", i + 1, class->std[i]->ID, class->std[i]->fullName, class->std[i]->email, class->std[i]->gender, class->std[i]->birthDay, class->std[i]->address);
        }
    }
}

void printNewStudentToFile(FILE *f, STUDENT newStudent) // Th√™m sinh vi√™n m·ªõi v√†o file
{
    fprintf(f, "%s:%s:%s:%s:%s:%s:%s\n", newStudent->ID, newStudent->lastName, newStudent->firstName, newStudent->email, newStudent->gender, newStudent->birthDay, newStudent->address);
}

void getStudentInfo(STUDENT student) // Nh·∫≠p th√¥ng tin sinh vi√™n
{
    printf("\n‚û°Ô∏è  Nh·∫≠p h·ªç v√† l√≥t: ");
    fgets(student->lastName, sizeof(student->lastName), stdin);
    removeEnter(student->lastName);
    toName(student->lastName);

    printf("\n‚û°Ô∏è  Nh·∫≠p t√™n: ");
    fgets(student->firstName, sizeof(student->firstName), stdin);
    removeEnter(student->firstName);
    toName(student->firstName);

    printf("\n‚û°Ô∏è  Nh·∫≠p ng√†y sinh: ");
    fgets(student->birthDay, sizeof(student->birthDay), stdin);
    removeEnter(student->birthDay);

    printf("\n‚û°Ô∏è  Nh·∫≠p gi·ªõi t√≠nh: ");
    fgets(student->gender, sizeof(student->gender), stdin);
    removeEnter(student->gender);
    toName(student->gender);

    printf("\n‚û°Ô∏è  Nh·∫≠p ƒë·ªãa ch·ªâ: ");
    fgets(student->address, sizeof(student->address), stdin);
    removeEnter(student->address);

    strcpy(student->ID, "");

    strcpy(student->email, "");

    sprintf(student->fullName, "%s %s", student->lastName, student->firstName);
}

bool isSorted(STUDENTLIST class) // Ki·ªÉm tra danh s√°ch ƒë√£ ƒë∆∞·ª£c s·∫Øp x·∫øp ch∆∞a
{
    for (int i = 1; i < class->count; i++)
    {
        if (strcmp(class->std[i]->firstName, class->std[i - 1]->firstName) < 0 or
            (strcmp(class->std[i]->firstName, class->std[i - 1]->firstName) == 0 and
             strcmp(class->std[i]->lastName, class->std[i - 1]->lastName) < 0))
        {
            return false;
        }
    }
    return true;
}

void readStudentInfoFromFile(FILE *f, STUDENTLIST class) // ƒê·ªçc th√¥ng tin sinh vi√™n t·ª´ file
{
    while (!feof(f)) // ƒê·ªçc ƒë·∫øn cu·ªëi file
    {
        STUDENT newStudent = malloc(sizeof(struct Student));
        char get;
        int index = 0;
        // ƒê·ªçc t·ª´ng th√¥ng tin c·ªßa sinh vi√™n c√°ch nhau b·ªüi d·∫•u ':'
        while ((get = fgetc(f)) != ':' and get != EOF)
        {
            newStudent->ID[index++] = get;
        }
        newStudent->ID[index] = '\0';
        index = 0;
        while ((get = fgetc(f)) != ':' and get != EOF)
        {
            newStudent->lastName[index++] = get;
        }
        newStudent->lastName[index] = '\0';
        index = 0;
        while ((get = fgetc(f)) != ':' and get != EOF)
        {
            newStudent->firstName[index++] = get;
        }
        newStudent->firstName[index] = '\0';
        index = 0;
        while ((get = fgetc(f)) != ':' and get != EOF)
        {
            newStudent->email[index++] = get;
        }
        newStudent->email[index] = '\0';
        index = 0;
        while ((get = fgetc(f)) != ':' and get != EOF)
        {
            newStudent->gender[index++] = get;
        }
        newStudent->gender[index] = '\0';
        index = 0;
        while ((get = fgetc(f)) != ':' and get != EOF)
        {
            newStudent->birthDay[index++] = get;
        }
        newStudent->birthDay[index] = '\0';
        index = 0;
        while ((get = fgetc(f)) != '\n' and get != EOF)
        {
            newStudent->address[index++] = get;
        }
        newStudent->address[index] = '\0';
        // Do d√≤ng cu·ªëi file l√† 1 d√≤ng tr·ªëng n√™n n√≥ s·∫Ω ƒëoc ra 1 sinh vi√™n r·ªóng
        if (newStudent->ID[0] == '\0' and newStudent->lastName[0] == '\0' and newStudent->firstName[0] == '\0' and
            newStudent->email[0] == '\0' and newStudent->gender[0] == '\0' and newStudent->birthDay[0] == '\0' and newStudent->address[0] == '\0')
        {
            break;
        }
        else
        {
            sprintf(newStudent->fullName, "%s %s", newStudent->lastName, newStudent->firstName);
            insertStudent(class, newStudent); // Th√™m sinh vi√™n v√†o danh s√°ch
        }
    }
    // Ki·ªÉm tra xem danh s√°ch ƒë√£ ƒë∆∞·ª£c s·∫Øp x·∫øp ch∆∞a
    if (isSorted(class))
        class->isSorted = true;
    else
        class->isSorted = false;

    if (strcmp(class->std[0]->ID, "") != 0)
        class->hasID = true;
    else
        class->hasID = false;
}

bool confirmExit() // X√°c nh·∫≠n tho√°t
{
    char choice;
    printf("\n‚ùì B·∫°n c√≥ mu·ªën ti·∫øp t·ª•c kh√¥ng? (Y/N): ");
    scanf(" %c", &choice);
    fflush(stdin);
    if (choice == 'Y' or choice == 'y')
    {
        return false;
    }
    return true;
}

void addStudent() // Th√™m sinh vi√™n
{
    char className[15];
    do
    {
        printListClassName();
        printf("\n‚û°Ô∏è  M·ªùi b·∫°n nh·∫≠p v√†o t√™n l·ªõp: ");
        fgets(className, sizeof(className), stdin);
        removeEnter(className);
        toUpper(className);
    } while (!checkClassName(className));

    char fileName[50];
    sprintf(fileName, "%s-%s.txt", facultyCode, className);
    FILE *fileCheck = fopen(fileName, "r");
    if (fileCheck == NULL)
    {
        fclose(fileCheck);
        FILE *file = fopen("class.txt", "a");
        fprintf(file, "%s-%s.txt\n", facultyCode, className);
        fclose(file);

        STUDENTLIST class = createClass(MAX_SIZE);
        FILE *f = fopen(fileName, "w");

        while (true)
        {
            STUDENT newStudent = malloc(sizeof(struct Student));

            getStudentInfo(newStudent);

            printNewStudentToFile(f, newStudent);
            printf("\nüéâ ƒê√£ th√™m sinh vi√™n th√†nh c√¥ng\n");

            if (confirmExit())
            {
                fclose(f);
                return;
            }
        }
    }
    else
    {
        fileCheck = fopen(fileName, "a");
        while (true)
        {
            STUDENT newStudent = malloc(sizeof(struct Student));

            getStudentInfo(newStudent);

            printNewStudentToFile(fileCheck, newStudent);
            printf("\nüéâ ƒê√£ th√™m sinh vi√™n th√†nh c√¥ng\n");
            if (confirmExit())
            {
                fclose(fileCheck);
                return;
            }
        }
    }
}

void swapStudent(STUDENT *student1, STUDENT *student2) // ƒê·ªïi ch·ªó 2 sinh vi√™n
{
    STUDENT tempStudent = *student1;
    *student1 = *student2;
    *student2 = tempStudent;
}

void quickSort(STUDENTLIST class, int start, int end)
{
    if (start < end)
    {
        int i = start - 1;
        for (int j = start; j < end; j++)
        {
            if (strcmp(class->std[j]->firstName, class->std[end]->firstName) < 0 or
                (strcmp(class->std[j]->firstName, class->std[end]->firstName) == 0 and strcmp(class->std[j]->lastName, class->std[end]->lastName) < 0))
            {
                swapStudent(&class->std[++i], &class->std[j]);
            }
        }
        swapStudent(&class->std[++i], &class->std[end]);
        quickSort(class, start, i - 1);
        quickSort(class, i + 1, end);
    }
}

void sortStudent() // S·∫Øp x·∫øp sinh vi√™n
{
    printListClassName();
    char className[15];
    do
    {
        printf("\n‚û°Ô∏è  Nh·∫≠p t√™n l·ªõp c·∫ßn s·∫Øp x·∫øp: ");
        fgets(className, sizeof(className), stdin);
        removeEnter(className);
        toUpper(className);
    } while (!checkClassName(className));

    char fileName[50];
    sprintf(fileName, "%s-%s.txt", facultyCode, className);
    FILE *fileCheck = fopen(fileName, "r");
    if (fileCheck == NULL)
    {
        printf("\nüîî L·ªõp %s ch∆∞a t·ªìn t·∫°i\n", className);
        return;
    }
    else
    {
        STUDENTLIST class = createClass(MAX_SIZE);
        readStudentInfoFromFile(fileCheck, class);
        fclose(fileCheck);
        if (class->isSorted)
        {
            printf("\nüîî L·ªõp %s ƒë√£ ƒë∆∞·ª£c s·∫Øp x·∫øp\n", className);
            return;
        }
        quickSort(class, 0, class->count - 1);
        FILE *f = fopen(fileName, "w");
        for (int i = 0; i < class->count; i++)
        {
            printNewStudentToFile(f, class->std[i]);
        }
        printf("\nüéâ ƒê√£ s·∫Øp x·∫øp l·ªõp %s\n", className);
        fclose(f);
    }
}

void printListStudent() // In danh s√°ch sinh vi√™n
{
    printListClassName();
    char className[15];
    do
    {
        printf("\n‚û°Ô∏è  Nh·∫≠p v√†o t√™n l·ªõp c·∫ßn in danh s√°ch: ");
        fgets(className, sizeof(className), stdin);
        removeEnter(className);
        toUpper(className);
    } while (!checkClassName(className));

    char fileName[50];
    sprintf(fileName, "%s-%s.txt", facultyCode, className);
    FILE *fileCheck = fopen(fileName, "r");
    if (fileCheck == NULL)
    {
        printf("\nüîî L·ªõp %s ch∆∞a t·ªìn t·∫°i\n", className);
        return;
    }
    else
    {
        STUDENTLIST class = createClass(MAX_SIZE);
        readStudentInfoFromFile(fileCheck, class);
        fclose(fileCheck);
        if (class->isSorted == false)
        {
            printf("\nüîî L·ªõp ch∆∞a ƒë∆∞·ª£c s·∫Øp x·∫øp, m·ªùi b·∫°n s·∫Øp x·∫øp l·ªõp tr∆∞·ªõc\n");
            return;
        }
        if (class->count == 0)
        {
            printf("\nüîî L·ªõp %s ch∆∞a c√≥ sinh vi√™n n√†o\n", className);
            return;
        }

        sprintf(fileName, "%s-%s-report.txt", facultyCode, className);
        FILE *f = fopen(fileName, "w");
        // In danh s√°ch sinh vi√™n ra file
        fprintf(f, "Danh s√°ch sinh vi√™n c·ªßa l·ªõp %s:\n\n", className);
        printClassToFile(class, f);
        printf("\nüéâ ƒê√£ in danh s√°ch sinh vi√™n c·ªßa l·ªõp %s\n", className);
        fclose(f);
    }
}

void generateID() // C·∫•p m√£ sinh vi√™n
{
    int numStudentHasID;
    char fileID[20];
    sprintf(fileID, ".id_%s_%s.txt", facultyCode, academicYear);
    FILE *f = fopen(fileID, "r");
    if (f == NULL)
    {
        f = fopen(fileID, "w");
        fprintf(f, "0");
        fclose(f);
        FILE *f = fopen(fileID, "r");
    }
    fscanf(f, "%d", &numStudentHasID);
    fclose(f);

    char className[15];
    do
    {
        printListClassName();
        printf("\n‚û°Ô∏è  M·ªùi b·∫°n nh·∫≠p v√†o t√™n l·ªõp: ");
        fgets(className, sizeof(className), stdin);
        removeEnter(className);
        toUpper(className);
    } while (!checkClassName(className));

    char fileName[30];
    sprintf(fileName, "%s-%s.txt", facultyCode, className);
    FILE *fileCheck = fopen(fileName, "r");
    if (fileCheck == NULL)
    {
        printf("\nüîî L·ªõp %s ch∆∞a t·ªìn t·∫°i\n", className);
        fclose(fileCheck);
        return;
    }
    else
    {
        STUDENTLIST class = createClass(MAX_SIZE);
        readStudentInfoFromFile(fileCheck, class);
        fclose(fileCheck);
        if (class->hasID == false)
        {
            if (class->isSorted == false)
            {
                printf("\nüîî L·ªõp %s ch∆∞a ƒë∆∞·ª£c s·∫Øp x·∫øp\n", className);
                return;
            }
        }

        FILE *f = fopen(fileID, "w");
        for (int i = 0; i < class->count; i++)
        {
            if (strcmp(class->std[i]->ID, "") == 0)
            {
                sprintf(class->std[i]->ID, "%s%s%04d", facultyCode, academicYear, ++numStudentHasID);
            }
        }
        fprintf(f, "%d", numStudentHasID);
        fclose(f);
        FILE *file = fopen(fileName, "w");
        for (int i = 0; i < class->count; i++)
        {
            printNewStudentToFile(file, class->std[i]);
        }
        printf("\nüéâ ƒê√£ c·∫•p m√£ sinh vi√™n cho l·ªõp %s\n", className);
        fclose(file);
    }
}

void generateEmail() // C·∫•p email
{
    char className[15];
    do
    {
        printListClassName();
        printf("\n‚û°Ô∏è  M·ªùi b·∫°n nh·∫≠p v√†o t√™n l·ªõp: ");
        fgets(className, sizeof(className), stdin);
        removeEnter(className);
        toUpper(className);
    } while (!checkClassName(className));

    char fileName[30];
    sprintf(fileName, "%s-%s.txt", facultyCode, className);
    FILE *fileCheck = fopen(fileName, "r");
    if (fileCheck == NULL)
    {
        printf("\nüîî L·ªõp %s ch∆∞a t·ªìn t·∫°i\n", className);
        fclose(fileCheck);
        return;
    }
    else
    {
        STUDENTLIST class = createClass(MAX_SIZE);
        readStudentInfoFromFile(fileCheck, class);
        fclose(fileCheck);
        if (class->hasID == false)
        {
            printf("\nüîî L·ªõp %s ch∆∞a ƒë∆∞·ª£c c·∫•p m√£ sinh vi√™n\n", className);
            return;
        }

        FILE *f = fopen(fileName, "w");
        for (int i = 0; i < class->count; i++)
            if (strcmp(class->std[i]->email, "") == 0)
                sprintf(class->std[i]->email, "%s@sv.dut.udn.vn", class->std[i]->ID);

        for (int i = 0; i < class->count; i++)
            printNewStudentToFile(f, class->std[i]);

        printf("\nüéâ ƒê√£ c·∫•p email cho l·ªõp %s\n", className);
        fclose(f);
    }
}

void removeStudent() // X√≥a sinh vi√™n
{
    char ID[10];
    printf("\n‚û°Ô∏è  M·ªùi b·∫°n nh·∫≠p ID: ");
    fflush(stdin);
    fgets(ID, sizeof(ID), stdin);
    removeEnter(ID);

    int found = 0;
    FILE *f = fopen("class.txt", "r");
    char fileClass[50];
    while (fgets(fileClass, sizeof(fileClass), f))
    {
        removeEnter(fileClass);
        FILE *fileCheck = fopen(fileClass, "r");
        if (fileCheck != NULL)
        {
            STUDENTLIST class = createClass();
            readStudentInfoFromFile(fileCheck, class);
            fclose(fileCheck);
            for (int i = 0; i < class->count; i++)
            {
                if (strcmp(class->std[i]->ID, ID) == 0)
                {
                    found = 1;
                    printf("\n‚ùì B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a sinh vi√™n %s %s? (Y/N): ", ID, class->std[i]->fullName);
                    char choice;
                    scanf(" %c", &choice);
                    if (choice == 'Y' or choice == 'y')
                    {
                        for (int k = i; k < class->count - 1; k++)
                        {
                            class->std[k] = class->std[k + 1];
                        }
                        class->count--;
                        printf("\nüëè ƒê√£ x√≥a sinh vi√™n c√≥ ID %s\n", ID);
                        FILE *f = fopen(fileClass, "w");
                        for (int k = 0; k < class->count; k++)
                        {
                            printNewStudentToFile(f, class->std[k]);
                        }
                        fclose(f);
                        return;
                    }
                    else
                        return;
                }
            }
        }
        else
            fclose(fileCheck);
    }
    if (!found)
        printf("\nüîî Kh√¥ng t√¨m th·∫•y sinh vi√™n c√≥ ID %s\n", ID);
}

void searchMenu() // Menu t√¨m ki·∫øm
{
    printf("\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
    printf("\n‚îÇ 1. T√¨m ki·∫øm theo t√™n  ‚îÇ");
    printf("\n‚îÇ 2. T√¨m ki·∫øm theo ID   ‚îÇ");
    printf("\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
    printf("\n\nM·ªùi b·∫°n ch·ªçn: ");
}

void searchStudentByName() // T√¨m ki·∫øm sinh vi√™n theo t√™n
{
    printf("\n‚û°Ô∏è  M·ªùi nh·∫≠p t√™n sinh vi√™n: ");
    char name[35];
    fflush(stdin);
    fgets(name, sizeof(name), stdin);
    removeEnter(name);
    toName(name);

    int found = 0;
    int count = 0;

    FILE *f = fopen("class.txt", "r");
    char fileClass[50];
    while (fgets(fileClass, sizeof(fileClass), f))
    {
        removeEnter(fileClass);
        FILE *fileCheck = fopen(fileClass, "r");
        if (fileCheck != NULL)
        {
            STUDENTLIST class = createClass();
            readStudentInfoFromFile(fileCheck, class);
            fclose(fileCheck);
            for (int i = 0; i < class->count; i++)
            {
                if (strstr(class->std[i]->fullName, name))
                {
                    found = 1;
                    printf("\nüîî T√¨m th·∫•y: %s  %s  %s  %s  %s  %s\n", class->std[i]->ID, class->std[i]->fullName, class->std[i]->email, class->std[i]->gender, class->std[i]->birthDay, class->std[i]->address);
                }
            }
        }
        else
            fclose(fileCheck);
    }

    if (!found)
        printf("\nüîî Kh√¥ng t√¨m th·∫•y sinh vi√™n t√™n %s\n", name);
    fclose(f);
}

void searchStudentByID() // T√¨m ki·∫øm sinh vi√™n theo ID
{
    char ID[10];
    printf("\n‚û°Ô∏è  M·ªùi b·∫°n nh·∫≠p ID b·∫°n mu·ªën t√¨m: ");
    fflush(stdin);
    fgets(ID, sizeof(ID), stdin);
    removeEnter(ID);

    int found = 0;
    FILE *f = fopen("class.txt", "r");
    char fileClass[50];
    while (fgets(fileClass, sizeof(fileClass), f))
    {
        removeEnter(fileClass);
        FILE *fileCheck = fopen(fileClass, "r");
        if (fileCheck != NULL)
        {
            STUDENTLIST class = createClass();
            readStudentInfoFromFile(fileCheck, class);
            fclose(fileCheck);
            for (int i = 0; i < class->count; i++)
            {
                if (strcmp(class->std[i]->ID, ID) == 0)
                {
                    found = 1;
                    printf("\nüîî T√¨m th·∫•y: %s  %s  %s  %s  %s  %s\n", class->std[i]->ID, class->std[i]->fullName, class->std[i]->email, class->std[i]->gender, class->std[i]->birthDay, class->std[i]->address);
                    return;
                }
            }
        }
        else
            fclose(fileCheck);
    }
    if (!found)
        printf("\nüîî Kh√¥ng t√¨m th·∫•y sinh vi√™n c√≥ ID %s\n", ID);
    fclose(f);
}

void searchStudent() // T√¨m ki·∫øm sinh vi√™n
{
    searchMenu();
    int choice;
    scanf("%d", &choice);
    switch (choice)
    {
    case 1:
        searchStudentByName();
        break;
    case 2:
        searchStudentByID();
        break;
    default:
        printf("\nCh·ªçn 1 ho·∫∑c 2\n");
        searchStudent(classList);
        break;
    }
}

void menu() // Menu ch√≠nh
{
    printf("\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n");
    printf("‚îÇ   1.  Th√™m sinh vi√™n                      ‚îÇ\n");
    printf("‚îÇ   2.  S·∫Øp x·∫øp sinh vi√™n                   ‚îÇ\n");
    printf("‚îÇ   3.  X√≥a sinh vi√™n                       ‚îÇ\n");
    printf("‚îÇ   4.  T√¨m sinh vi√™n                       ‚îÇ\n");
    printf("‚îÇ   5.  C·∫•p m√£ sinh vi√™n                    ‚îÇ\n");
    printf("‚îÇ   6.  C·∫•p email                           ‚îÇ\n");
    printf("‚îÇ   7.  In danh s√°ch sinh vi√™n              ‚îÇ\n");
    printf("‚îÇ   8.  Tho√°t                               ‚îÇ\n");
    printf("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n");
    printf("\nM·ªùi b·∫°n ch·ªçn: ");
}

void loading() // Loading
{
    printf("\n\n");
    for (int i = 0; i <= 25; i++)
    {
        printf("\rLoading [");
        for (int j = 0; j < i; j++)
            printf("=");
        for (int j = i; j < 25; j++)
            printf(" ");
        printf("] %d%%", i * 4);
        Sleep(50);
    }
}

void encrypt(char string[]) // M√£ h√≥a th√†nh chu·ªói hex
{
    char *hex = malloc(strlen(string) * 2 + 1);
    for (int i = 0; i < strlen(string); i++)
    {
        sprintf(&hex[i * 2], "%02x", string[i]);
    }
    strcpy(string, hex);
}

void decrypt(char string[]) // Gi·∫£i m√£
{
    // 1 byte = 2 hex
    /*"%2hhx" :     2:ƒê·ªçc ƒë√∫ng 2 k√Ω t·ª± t·ª´ chu·ªói ƒë·∫ßu v√†o
                    hh: Ch·ªâ ƒë·ªãnh r·∫±ng gi√° tr·ªã ƒë·ªçc ƒë∆∞·ª£c s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi th√†nh m·ªôt unsigned char
                    x: Ch·ªâ ƒë·ªãnh r·∫±ng gi√° tr·ªã ƒë·ªçc ƒë∆∞·ª£c l√† m·ªôt s·ªë h·ªá th·∫≠p l·ª•c ph√¢n.*/

    char *byte = malloc(strlen(string) / 2 + 1);
    for (int i = 0; i < strlen(string); i += 2)
    {
        sscanf(&string[i], "%2hhx", &byte[i / 2]);
    }
    strcpy(string, byte);
}

void inputPassword(char password[]) // Nh·∫≠p password
{
    int i = 0;
    char get;
    while (i < MAX_PASSWORD_LENGTH)
    {
        get = getch();
        if (get == '\r' or get == '\n')
            break;
        else if (get == '\b')
        {
            if (i > 0)
            {
                printf("\b \b");
                i--;
            }
            else
                printf(" \b");
        }
        else
        {
            password[i++] = get;
            printf("‚Ä¢");
        }
    }
    password[i] = '\0';
}

void readUsernameAndPasswordFromFile(FILE *f, char username[], char password[]) // ƒê·ªçc username v√† password t·ª´ file
{
    char get;
    int index = 0;

    while ((get = fgetc(f)) != ':' and get != EOF)
    {
        username[index++] = get;
    }
    username[index] = '\0';

    index = 0;
    while ((get = fgetc(f)) != '\n' and get != EOF)
    {
        password[index++] = get;
    }
    password[index] = '\0';
}

bool isValidUsername(char username[]) // Ki·ªÉm tra username c√≥ h·ª£p l·ªá hay kh√¥ng
{
    if (strlen(username) < MIN_USERNAME_LENGTH or strlen(username) > MAX_USERNAME_LENGTH)
    {
        printf("\n‚ö†Ô∏è  Username ph·∫£i c√≥ t·ª´ %d ƒë·∫øn %d k√Ω t·ª±\n\n", MIN_USERNAME_LENGTH, MAX_USERNAME_LENGTH);
        return false;
    }
    for (int i = 0; i < strlen(username); i++)
    {
        if (username[i] == ' ')
        {
            printf("\n‚ö†Ô∏è  Username kh√¥ng ƒë∆∞·ª£c ch·ª©a kho·∫£ng tr·∫Øng\n\n");
            return false;
        }
    }
    FILE *f = fopen("index.txt", "r");
    if (f == NULL)
    {
        printf("Kh√¥ng th·ªÉ m·ªü file\n");
        return false;
    }
    char user[MAX_USERNAME_LENGTH], pass[MAX_PASSWORD_LENGTH];
    while (1)
    {
        if (feof(f))
            break;

        readUsernameAndPasswordFromFile(f, user, pass);

        decrypt(user);
        if (strcmp(user, username) == 0)
        {
            printf("\n‚ö†Ô∏è  Username ƒë√£ t·ªìn t·∫°i\n\n");
            fclose(f);
            return false;
        }
    }
    fclose(f);
    return true;
}

bool isValidPassword(char password[]) // Ki·ªÉm tra password c√≥ h·ª£p l·ªá hay kh√¥ng
{
    bool hasUppercase = false;
    bool hasLowercase = false;
    bool hasNumber = false;
    bool hasSpace = false;

    if (strlen(password) < MIN_PASSWORD_LENGTH or strlen(password) > MAX_PASSWORD_LENGTH)
    {
        printf("\n\n‚ö†Ô∏è  Password ph·∫£i c√≥ √≠t nh·∫•t %d k√Ω t·ª±\n\n", MIN_PASSWORD_LENGTH);
        return false;
    }

    for (int i = 0; i < strlen(password); i++)
    {
        if (password[i] == ' ')
        {
            hasSpace = true;
        }
        else if (isUpper(password[i]))
        {
            hasUppercase = true;
        }
        else if (isLower(password[i]))
        {
            hasLowercase = true;
        }
        else if (isNumber(password[i]))
        {
            hasNumber = true;
        }
    }
    if (!hasUppercase)
    {
        printf("\n\n‚ö†Ô∏è  Password ph·∫£i ch·ª©a √≠t nh·∫•t 1 k√Ω t·ª± in hoa\n\n");
        return false;
    }
    if (!hasLowercase)
    {
        printf("\n\n‚ö†Ô∏è  Password ph·∫£i ch·ª©a √≠t nh·∫•t 1 k√Ω t·ª± th∆∞·ªùng\n\n");
        return false;
    }
    if (!hasNumber)
    {
        printf("\n\n‚ö†Ô∏è  Password ph·∫£i ch·ª©a √≠t nh·∫•t 1 s·ªë\n\n");
        return false;
    }
    if (hasSpace)
    {
        printf("\n\n‚ö†Ô∏è  Password kh√¥ng ƒë∆∞·ª£c ch·ª©a kho·∫£ng tr·∫Øng\n\n");
        return false;
    }

    return true;
}

void registerNewAccount() // ƒêƒÉng k√≠ t√†i kho·∫£n
{
    system("cls");
    char username[MAX_USERNAME_LENGTH];
    char password[MAX_PASSWORD_LENGTH];
    FILE *f = fopen("index.txt", "a");
    printf("\n\t=============== Register Page ===============\n\n");

    printf("\n(Username ph·∫£i c√≥ t·ª´ %d ƒë·∫øn %d k√Ω t·ª± v√† kh√¥ng ch·ª©a kho·∫£ng tr·∫Øng)", MIN_USERNAME_LENGTH, MAX_USERNAME_LENGTH);
    printf("\n(Password d√†i t·ªëi thi·ªÉu %d k√≠ t·ª±, ph·∫£i ch·ª©a √≠t nh·∫•t 1 k√Ω t·ª± in hoa, 1 k√Ω t·ª± th∆∞·ªùng, 1 s·ªë v√† kh√¥ng ch·ª©a kho·∫£ng tr·∫Øng)\n\n", MIN_PASSWORD_LENGTH);

    do
    {
        printf("Username: ");
        fgets(username, sizeof(username), stdin);
        removeEnter(username);
    } while (!isValidUsername(username));
    encrypt(username);
    fprintf(f, "%s:", username);
    do
    {
        printf("Password: ");
        inputPassword(password);
    } while (!isValidPassword(password));
    encrypt(password);
    fprintf(f, "%s\n", password);
    fclose(f);
    printf("\n\nüéâ ƒêƒÉng k√≠ th√†nh c√¥ng!");
    Sleep(500);
    loading();
}

bool checkPassword(char password[], char userInputPass[]) // Ki·ªÉm tra password c√≥ ƒë√∫ng hay kh√¥ng
{
    decrypt(password);
    if (strcmp(password, userInputPass) == 0)
        return true;
    return false;
}

bool checkUsername(char userName[], char usernameInput[]) // Ki·ªÉm tra username c√≥ ƒë√∫ng hay kh√¥ng
{
    decrypt(userName);
    if (strcmp(userName, usernameInput) == 0)
        return true;
    return false;
}

bool checkUsernameAndPassword(char inputUsername[], char inputPassword[]) // ƒê·ªçc t·ª´ file v√† ki·ªÉm tra username v√† password
{
    FILE *f = fopen("index.txt", "r");
    char username[25];
    char password[25];
    while (true)
    {
        if (feof(f))
            break;

        readUsernameAndPasswordFromFile(f, username, password);

        if (checkUsername(username, inputUsername) and checkPassword(password, inputPassword))
        {
            fclose(f);
            return true;
        }
    }
    fclose(f);
    return false;
}

bool login() // ƒêƒÉng nh·∫≠p
{
    system("cls");
    char username[MAX_USERNAME_LENGTH];
    char password[MAX_PASSWORD_LENGTH];
    int checkLogin = 0;
    printf("\n\t=============== Login Page ===============\n\n");
    while (true)
    {
        printf("Username : ");
        fgets(username, sizeof(username), stdin);
        removeEnter(username);
        printf("Password : ");
        inputPassword(password);
        if (checkUsernameAndPassword(username, password))
        {
            printf("\n\nüéâ Ch√†o m·ª´ng b·∫°n ƒë√£ tr·ªü l·∫°i!");
            Sleep(555);
            loading();
            system("cls");
            return true;
        }
        else
        {
            checkLogin++;
            if (checkLogin < 5)
                printf("\n\n‚ö†Ô∏è  Sai Username ho·∫∑c Password. H√£y th·ª≠ l·∫°i!\n\n");
        }
        if (checkLogin == 5)
            break;
    }
    printf("\n\n‚ùå Login failed!\n");
    return false;
}

void runProgram() // Ch∆∞∆°ng tr√¨nh ch√≠nh
{
    inputCode();
    int choice;
    printf("\n------------CH∆Ø∆†NG TR√åNH QU·∫¢N L√ç SINH VI√äN------------\n\n");
    do
    {
        menu();
        scanf("%d", &choice);
        fflush(stdin);
        switch (choice)
        {
        case 1:
            addStudent();
            break;
        case 2:
            sortStudent();
            break;
        case 3:
            removeStudent();
            break;
        case 4:
            searchStudent();
            break;
        case 5:
            generateID();
            break;
        case 6:
            generateEmail();
            break;
        case 7:
            printListStudent();
            break;
        case 8:
            printf("\nüëã  H·∫πn g·∫∑p l·∫°i");
            break;
        default:
            printf("\n‚ö†Ô∏è  Vui l√≤ng ch·ªçn t·ª´ 1 ƒë·∫øn 8\n");
            break;
        }
    } while (choice != 8);
}

#endif